<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title></title>
  <link rel="stylesheet" href="css/style.css">
</head>

<body>
  <div id="menu">
    <img onclick="notvisi()" src="icons/menu_black_24dp.svg" alt="menu lines">
    <p><a href="/">Deals Ganaga</a></p>
  </div>

  <nav id="visible" class="notvisi">
    <ol>
      <li><a href="/">Home</a></li>
      <li><a href="/site.html?name=amazon">Amazon</a> </li>
      <li><a href="/site.html?name=flipkart">Flipkart</a></li>
      <li><a href="/site.html?name=ajio">Ajio</a> </li>
      <li><a href="/site.html?name=myntra">Myntra</a> </li>
    </ol>
  </nav>
  <div id="cat">
    <!-- inserting data dynamicly -->
  </div>
  <!-- creating h1 dynamicaly -->
  <div id="main">


  </div>
</body>

<script>
  let param = new URLSearchParams(document.location.search);
  let sitename = param.get("name");
  let cat = param.get('category')


  if (sitename == null) {
    sitename = "amazon";
  }
  if (cat == null) {
    cat = 'Mens Wear'
  }
  console.log(cat)
  cat = cat.split('-').join(' ')
  //console.log(cat);

  async function main() {
    let res = await fetch(`https://payme-bce76.firebaseio.com/deals/${sitename}.json`);
    let data = await res.json();

    console.log(data);

    let cate = document.getElementById("cat");
    let main = document.getElementById('main');
    let h1 = `<h1>Best Deals on ${cat} from ${sitename}</h1>`
    main.insertAdjacentHTML('beforebegin', h1);
    let arr = Object.keys(data['category']);
    //console.log(arr)
    arr.forEach(catname => {
      let ncatname = catname.split(' ').join('+')

      let catdata = `<a href="/site.html?name=${sitename}&category=${ncatname}">${catname}</a>`
      cate.insertAdjacentHTML("beforeend", catdata);

    });
    let header = Object.keys(data['category'][cat]);
    header.forEach(headname => {
      let headertxt = `<h2>${headname}</h2>

`
      //console.log(data['category'][cat][headname]);
      main.insertAdjacentHTML('beforeend', headertxt);

      childin = document.createElement('div')
      childin.className = 'child_inside';
      //console.log(childin)
      let contenthtml;

      contentkey = Object.keys(data['category'][cat][headname]);
      contentkey.forEach(contentval => {
        let childdata = data['category'][cat][headname][contentval]
        //console.log(conte)
        let lcat = cat.split(' ').join('+');
        let lheadname = headname.split(' ').join('+');
        let lcontentval = contentval.split(' ').join('+');
        let contenthtml = `
  <div class= "child">
    <div class="imgdiv">
       <img src="${childdata["image"]}" alt="">
    </div>
    <div class="details">
      <p class="title">${contentval}</p>
      <p class="prc">${childdata["price"]}</p>
      <button><a href="details.html?site=${sitename}&category=${lcat}&title=${lheadname}&name=${lcontentval}">View Details</a></button>
    </div>
    
  </div>
  `
        let parser = new DOMParser();
        let elem = parser.parseFromString(contenthtml, 'text/html').body.firstChild
        childin.appendChild(elem)
        //console.log(childin)


      })
      main.appendChild(childin)
    });

    //console.log(main)

  }
  main()
</script>
<script>
  function notvisi() {

    let btn = document.getElementById('visible');

    btn.classList.toggle('notvisi');

  }
</script>

</html>