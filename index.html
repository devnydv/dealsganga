<!DOCTYPE html>
<html lang="en">
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>LowonCost: Every product at lowest price</title>
  <link rel="stylesheet" href="css/style.css">
  <link rel="shortcut icon" href="icons/icon.webp" type="image/x-icon">
  <link rel="apple-touch-icon" href="icons/icon.webp">
</head>

<body>
  <div id="menu">
    <img onclick="notvisi()" src="icons/menu_black_24dp.svg" alt="menu-lines">
    <p><a href="/">Lowoncost</a></p>
  </div>

  <nav id="visible" class="notvisi">
    <ol>
      <li><a href="/" title="Home">Home</a></li>
      <li><a href="site?name=amazon" title="Amazon">Amazon</a> </li>
      <li><a href="site?name=flipkart" title="Flipkart">Flipkart</a></li>
      <li><a href="site?name=ajio" title="Ajio">Ajio</a></li>
      <li><a href="site?name=myntra" title="Myntra">Myntra</a></li>
    </ol>
  </nav>
  <div id="cat">
    <!-- inserting data dynamicly -->
  </div>

  <h1>Lowoncost: Every product at lowest price</h1>

  <div id="main">

    <!--creating dynamic h2-->

    <div class="child_inside">
      <!--creating dynamic child_inside-->


    </div>


  </div>
</body>
<script>
  async function main() {
    let res = await fetch(`https://payme-bce76.firebaseio.com/deals/home.json`);
    let data = await res.json();
    console.log(data);

    let cat = document.getElementById("cat");
    let arr = Object.keys(data['category']);
    //console.log(arr)
    arr.forEach(catname => {
      let upcatname = catname[0].toUpperCase() + catname.slice(1);
      console.log(upcatname)
      let catdata = `<a href="site?name=${catname}" title="${catname}">${upcatname}</a>`
      cat.insertAdjacentHTML("beforeend", catdata);

      let main = document.getElementById('main');
      let headertxt = `<h2>Top category from ${upcatname}</h2>`
      main.insertAdjacentHTML("beforeend", headertxt);
      let childin = document.createElement('div')

      childin.className = 'child_inside';

      let contentkey = Object.keys(data['category'][catname]['items'])
      //console.log(contentkey)
      contentkey.forEach(contentval => {
        let childdata = data['category'][catname]['items'][contentval];
        let category = childdata["category"]
        let title = childdata["title"]


        let ncategory=category.split(' ').join("+");
        let ntitle=title.split(' ').join("+");
        let ncontentval= contentval.split(' ').join("+");
        //console.log(title);
        let contenthtml = `
  <div class= "child">
    <div class="imgdiv">
       <img src="${childdata["image"]}" alt=${contentval}>
    </div>
    <div class="details">
      <p class="title">${contentval}</p>
      <p class="prc">${childdata["price"]}</p>
      <button><a href="details?site=${catname}&category=${ncategory}&title=${ntitle}&name=${ncontentval}" title="View details of ${contentval}">View Details</a></button>
    </div>
    
  </div>
  `

        let parser = new DOMParser();
        let elem = parser.parseFromString(contenthtml, 'text/html').body.firstChild
        childin.appendChild(elem)
        //console.log(childin)
      })


      
      main.appendChild(childin);
      let sitelink = `<div class="sitelink"><a href="site?name=${catname}" title="See More from ${catname}">See More from ${upcatname}</a></div>`
      main.insertAdjacentHTML("beforeend", sitelink);

    });


  }
  main()


</script>
<script>

  function notvisi() {

    let btn = document.getElementById('visible');

    btn.classList.toggle('notvisi');

  }
</script>

</html>
